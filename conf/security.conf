# Общие правила безопасности
server {
    listen 80;
    server_name localhost platform.local;
    
    # ==================== SECURITY RULES ====================
    
    # Запрещаем доступ к скрытым файлам
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
        return 404;
    }
    
    # Запрещаем доступ к конфиденциальным файлам
    location ~* \.(log|sql|env|sh|key|pem|crt|conf|cfg|ini|bak|backup)$ {
        deny all;
        access_log off;
        log_not_found off;
        return 403;
    }
    
    # Запрещаем доступ к системным файлам
    location ~* (\.git|\.svn|\.htaccess|\.htpasswd|/uploads/.*\.php) {
        deny all;
        access_log off;
        log_not_found off;
        return 403;
    }
    
    # Заголовки безопасности (применяются ко всему)
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;
    add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:;" always;
}