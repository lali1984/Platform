global:
  scrape_interval: 30s
  evaluation_interval: 30s
  external_labels:
    cluster: 'platform-ecosystem'
    environment: 'production'
  
scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
    scrape_interval: 30s

  # Application Services
  - job_name: 'auth-service'
    static_configs:
      - targets: ['auth-service:3000']
    metrics_path: '/metrics'
    scrape_interval: 30s
    scrape_timeout: 15s
    honor_labels: true
    relabel_configs:
      - source_labels: [__address__]
        target_label: instance
        regex: '([^:]+):\d+'
        replacement: '${1}'

  - job_name: 'user-service'
    static_configs:
      - targets: ['user-service:3000']
    metrics_path: '/metrics'
    scrape_interval: 30s
    scrape_timeout: 15s
    honor_labels: true

  - job_name: 'bff-gateway'
    static_configs:
      - targets: ['bff-gateway:3000']
    metrics_path: '/metrics'
    scrape_interval: 30s
    scrape_timeout: 15s
    honor_labels: true

  - job_name: 'event-relay'
    static_configs:
      - targets: ['event-relay:3006']
    metrics_path: '/metrics'
    scrape_interval: 30s
    scrape_timeout: 15s
    honor_labels: true
    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'go_.*'
        action: drop

  # Infrastructure Exporters
  - job_name: 'postgres-exporter'
    static_configs:
      - targets: ['postgres-exporter:9187']
    scrape_interval: 30s
    scrape_timeout: 15s

  - job_name: 'redis-exporter'
    static_configs:
      - targets: ['redis-exporter:9121']
    scrape_interval: 30s
    scrape_timeout: 15s

  - job_name: 'kafka-exporter'
    static_configs:
      - targets: ['kafka-exporter:9308']
    scrape_interval: 30s
    scrape_timeout: 15s

  - job_name: 'node-exporter'
    static_configs:
      - targets: ['node-exporter:9100']
    scrape_interval: 30s
    scrape_timeout: 15s
    metric_relabel_configs:
      - source_labels: [__name__]
        regex: 'node_filesystem_files_free|node_filesystem_readonly'
        action: drop

# Alerting rules
rule_files:
  - "/etc/prometheus/rules/*.yml"

alerting:
  alertmanagers:
    - static_configs:
        - targets:
          - alertmanager:9093

# Storage
remote_write:
  - url: http://thanos-receive:10908/api/v1/receive

remote_read:
  - url: http://thanos-query:10904/api/v1/read