# üîê Auth Service

–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø–∞–º Clean Architecture –∏ Domain-Driven Design.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [Bounded Context](#bounded-context)
- [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å](#—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å)
- [API Endpoints](#api-endpoints)
- [–°–æ–±—ã—Ç–∏—è Kafka](#—Å–æ–±—ã—Ç–∏—è-kafka)
- [–ó–∞–ø—É—Å–∫ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ](#–∑–∞–ø—É—Å–∫-–∏-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥)
- [–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞](#—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### Clean Architecture (4 —Å–ª–æ—è)

```
src/
‚îú‚îÄ‚îÄ domain/                    # –ß–∏—Å—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ entities/             # –°—É—â–Ω–æ—Å—Ç–∏ (User)
‚îÇ   ‚îî‚îÄ‚îÄ ports/                # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (Ports)
‚îú‚îÄ‚îÄ application/              # Use Cases
‚îÇ   ‚îî‚îÄ‚îÄ use-cases/           # –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ infrastructure/           # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ä—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ config/              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ persistence/         # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏ —Å—É—â–Ω–æ—Å—Ç–∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ services/            # –°–µ—Ä–≤–∏—Å—ã (JWT, 2FA)
‚îÇ   ‚îî‚îÄ‚îÄ event-publishers/    # –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π
‚îî‚îÄ‚îÄ presentation/            # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –∏ –º–∞—Ä—à—Ä—É—Ç—ã
    ‚îú‚îÄ‚îÄ controllers/
    ‚îú‚îÄ‚îÄ middleware/
    ‚îî‚îÄ‚îÄ routes/
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **Dependency Rule**: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–Ω—É—Ç—Ä—å
2. **Ports & Adapters**: –í—Å–µ –≤–Ω–µ—à–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
3. **Outbox Pattern**: –°–æ–±—ã—Ç–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è —á–µ—Ä–µ–∑ outbox —Ç–∞–±–ª–∏—Ü—É
4. **Minimal Dependencies**: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

## üéØ Bounded Context

**–ö–æ–Ω—Ç–µ–∫—Å—Ç**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º

**–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å**:
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏ (JWT —Ç–æ–∫–µ–Ω—ã)
- –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA)
- –í–∞–ª–∏–¥–∞—Ü–∏—è —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–ì—Ä–∞–Ω–∏—Ü—ã**:
- –ù–µ —Ö—Ä–∞–Ω–∏—Ç –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—ç—Ç–æ `user-service`)
- –ù–µ —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–æ–ª—è–º–∏ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è–º–∏ (—ç—Ç–æ `authorization-service`)
- –ù–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –¥–ª—è `notification-service`)

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
   - –í–∞–ª–∏–¥–∞—Ü–∏—è email –∏ –ø–∞—Ä–æ–ª—è
   - –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (bcrypt)
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–æ–≤
   - –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è `UserRegistered`

2. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è access/refresh —Ç–æ–∫–µ–Ω–æ–≤
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
   - –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –≤—Ö–æ–¥–∞/–≤—ã—Ö–æ–¥–∞

3. **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA)**
   - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤ –¥–ª—è TOTP
   - –í–∞–ª–∏–¥–∞—Ü–∏—è 2FA –∫–æ–¥–æ–≤
   - –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ 2FA
   - –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã

4. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - Rate limiting –¥–ª—è –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤
   - –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF
   - CORS –ø–æ–ª–∏—Ç–∏–∫–∏

## üì° API Endpoints

### REST API

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ | –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è |
|-------|----------|----------|----------------|
| POST | `/api/auth/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è | ‚ùå |
| POST | `/api/auth/login` | –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É | ‚ùå |
| POST | `/api/auth/logout` | –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã | ‚úÖ |
| POST | `/api/auth/refresh` | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ | ‚úÖ (refresh token) |
| GET | `/api/auth/me` | –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–µ–∫—É—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ | ‚úÖ |
| POST | `/api/auth/2fa/enable` | –í–∫–ª—é—á–µ–Ω–∏–µ 2FA | ‚úÖ |
| POST | `/api/auth/2fa/disable` | –û—Ç–∫–ª—é—á–µ–Ω–∏–µ 2FA | ‚úÖ |
| POST | `/api/auth/2fa/verify` | –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è 2FA –∫–æ–¥–∞ | ‚úÖ |
| GET | `/api/auth/2fa/qr-code` | –ü–æ–ª—É—á–µ–Ω–∏–µ QR-–∫–æ–¥–∞ –¥–ª—è 2FA | ‚úÖ |
| POST | `/api/auth/password/reset-request` | –ó–∞–ø—Ä–æ—Å —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª—è | ‚ùå |
| POST | `/api/auth/password/reset` | –°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è | ‚ùå (—Å —Ç–æ–∫–µ–Ω–æ–º) |

### Health Checks

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|----------|
| GET | `/health` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞ |
| GET | `/health/db` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –ë–î |
| GET | `/health/kafka` | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Kafka |

## üìä –°–æ–±—ã—Ç–∏—è Kafka

### –¢–æ–ø–∏–∫–∏

| –¢–æ–ø–∏–∫ | –û–ø–∏—Å–∞–Ω–∏–µ | –°–æ–±—ã—Ç–∏—è |
|-------|----------|---------|
| `auth.events.v1` | –°–æ–±—ã—Ç–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ | `UserLoggedIn`, `UserLoginFailed`, `TwoFactorEnabled` |
| `user.events.v1` | –°–æ–±—ã—Ç–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | `UserRegistered`, `UserUpdated` |
| `security.events.v1` | –°–æ–±—ã—Ç–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ | `PasswordResetRequested`, `PasswordResetCompleted` |
| `auth.dlq.v1` | Dead Letter Queue | –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è |

### –¢–∏–ø—ã —Å–æ–±—ã—Ç–∏–π

```typescript
// –í shared/kafka/src/types/events.ts
export enum EventType {
  USER_REGISTERED = 'user.registered',
  USER_LOGGED_IN = 'user.logged.in',
  USER_LOGIN_FAILED = 'user.login.failed',
  TWO_FACTOR_ENABLED = 'two.factor.enabled',
  PASSWORD_RESET_REQUESTED = 'password.reset.requested',
  // ...
}
```

### Outbox Pattern

–í—Å–µ —Å–æ–±—ã—Ç–∏—è –ø—É–±–ª–∏–∫—É—é—Ç—Å—è —á–µ—Ä–µ–∑ outbox —Ç–∞–±–ª–∏—Ü—É:
1. –°–æ–±—ã—Ç–∏–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ `outbox_events` –≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
2. –û—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å (`event-relay`) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–±—ã—Ç–∏—è –≤ Kafka
3. –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞

## üê≥ –ó–∞–ø—É—Å–∫ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
git clone <repository-url>
cd platform-ecosystem/03_auth-service

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
cp .env.example .env
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env —Ñ–∞–π–ª

# –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
npm run dev

# –ò–ª–∏ —á–µ—Ä–µ–∑ Docker Compose
docker-compose up --build
```

### Docker

```bash
# –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
docker build -t auth-service .

# –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
docker run -p 3001:3001 \
  -e DATABASE_URL=postgresql://user:pass@host:5432/auth_db \
  -e JWT_SECRET=your-secret-key \
  auth-service
```

### Kubernetes (Helm)

```yaml
# values.yaml
replicaCount: 3
image:
  repository: auth-service
  tag: latest
  pullPolicy: IfNotPresent

service:
  type: ClusterIP
  port: 3001

env:
  DATABASE_URL: postgresql://user:pass@postgres:5432/auth_db
  JWT_SECRET: ${JWT_SECRET}
  KAFKA_BROKERS: kafka:9092
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–∏–ø—ã —Ç–µ—Å—Ç–æ–≤

```bash
# Unit —Ç–µ—Å—Ç—ã (–¥–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞)
npm run test:unit

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
npm run test:integration

# E2E —Ç–µ—Å—Ç—ã
npm run test:e2e

# –í—Å–µ —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
npm run test
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –ø–æ–∫—Ä—ã—Ç–∏—é:
- –î–æ–º–µ–Ω: ‚â• 90%
- Use Cases: ‚â• 80%
- –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã: ‚â• 70%

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
   - –£—Å–ø–µ—à–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
   - –î—É–±–ª–∏–∫–∞—Ç email
   - –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π email/–ø–∞—Ä–æ–ª—å

2. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
   - –£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥
   - –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å
   - –ù–µ–∞–∫—Ç–∏–≤–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç
   - 2FA —Ç—Ä–µ–±—É–µ—Ç—Å—è/–≤–∞–ª–∏–¥–∞—Ü–∏—è

3. **2FA –æ–ø–µ—Ä–∞—Ü–∏–∏**
   - –í–∫–ª—é—á–µ–Ω–∏–µ/–æ—Ç–∫–ª—é—á–µ–Ω–∏–µ
   - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–¥–æ–≤
   - –†–µ–∑–µ—Ä–≤–Ω—ã–µ –∫–æ–¥—ã

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|-----|----------|
| `auth_requests_total` | Counter | –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ |
| `auth_requests_duration_seconds` | Histogram | –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ |
| `auth_login_attempts` | Counter | –ü–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞ (—É—Å–ø–µ—à–Ω—ã–µ/–Ω–µ—É—Å–ø–µ—à–Ω—ã–µ) |
| `auth_tokens_generated` | Counter | –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã |
| `kafka_messages_published` | Counter | –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è |

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON:

```json
{
  "timestamp": "2024-01-15T10:30:00Z",
  "level": "info",
  "service": "auth-service",
  "userId": "uuid",
  "event": "UserRegistered",
  "duration": 150,
  "ip": "192.168.1.1"
}
```

### –ê–ª–µ—Ä—Ç—ã

| –ê–ª–µ—Ä—Ç | –£—Å–ª–æ–≤–∏–µ | –î–µ–π—Å—Ç–≤–∏–µ |
|-------|---------|----------|
| –í—ã—Å–æ–∫–∞—è —á–∞—Å—Ç–æ—Ç–∞ –æ—à–∏–±–æ–∫ | > 5% –æ—à–∏–±–æ–∫ –∑–∞ 5 –º–∏–Ω—É—Ç | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ Slack |
| –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã | p95 > 1 —Å–µ–∫—É–Ω–¥–∞ | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º |
| –°–±–æ–π –ë–î | –ù–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è > 30 —Å–µ–∫—É–Ω–¥ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ |
| –õ–∞–≥ Kafka | > 1000 —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –ª–∞–≥–µ | –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ DevOps |

## üõ†Ô∏è –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# Dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (—É–∂–µ –≤ package.json)
npm install --save-dev @types/node typescript jest ts-jest

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm update
```

### –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏
npm run migration:generate -- -n MigrationName

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
npm run migration:run

# –û—Ç–∫–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π –º–∏–≥—Ä–∞—Ü–∏–∏
npm run migration:revert
```

### Code Style

```bash
# –õ–∏–Ω—Ç–∏–Ω–≥
npm run lint

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
npm run format

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
npx tsc --noEmit
```

### Git Workflow

1. –°–æ–∑–¥–∞—Ç—å –≤–µ—Ç–∫—É –æ—Ç `main`: `feature/auth-new-feature`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å —Ç–µ—Å—Ç–∞–º–∏
3. –ü—Ä–æ–π—Ç–∏ –ª–∏–Ω—Ç–∏–Ω–≥ –∏ —Ç–µ—Å—Ç—ã
4. –°–æ–∑–¥–∞—Ç—å Pull Request
5. Code review + approval
6. –ú–µ—Ä–∂ –≤ `main`

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://user:pass@localhost:5432/auth_db
DATABASE_SSL=false

# JWT
JWT_SECRET=your-super-secret-key-change-in-production
JWT_ACCESS_EXPIRES_IN=15m
JWT_REFRESH_EXPIRES_IN=7d

# Kafka
KAFKA_BROKERS=localhost:9092
KAFKA_CLIENT_ID=auth-service
KAFKA_GROUP_ID=auth-service-group

# –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
PORT=3001
NODE_ENV=development
LOG_LEVEL=info

# 2FA
TWO_FACTOR_APP_NAME="Platform Ecosystem"
TWO_FACTOR_ISSUER="Auth Service"
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `src/infrastructure/config/database.config.ts` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è TypeORM
- `src/infrastructure/config/migration.config.ts` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
- `jest.config.js` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Jest
- `tsconfig.json` - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è TypeScript

## ü§ù –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –¥—Ä—É–≥–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

| –°–µ—Ä–≤–∏—Å | –¢–∏–ø –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ | –ü—Ä–æ—Ç–æ–∫–æ–ª |
|--------|-----------------|----------|
| `user-service` | –°–æ–±—ã—Ç–∏—è (outbound) | Kafka |
| `notification-service` | –°–æ–±—ã—Ç–∏—è (outbound) | Kafka |
| `event-relay` | –ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ outbox | –ë–î |
| PostgreSQL | –•—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö | TCP |
| Kafka | –û–±–º–µ–Ω —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ | TCP |

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π

1. **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
   ```
   auth-service ‚Üí [UserRegistered event] ‚Üí Kafka ‚Üí user-service (—Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è)
   ```

2. **–í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É**:
   ```
   auth-service ‚Üí [UserLoggedIn event] ‚Üí Kafka ‚Üí notification-service (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ)
   ```

3. **–°–±—Ä–æ—Å –ø–∞—Ä–æ–ª—è**:
   ```
   auth-service ‚Üí [PasswordResetRequested] ‚Üí Kafka ‚Üí notification-service (email)
   ```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è (ADR)](../docs/adr/)
- [–°—Ö–µ–º—ã —Å–æ–±—ã—Ç–∏–π](../shared/kafka/src/types/events.ts)
- [–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏](../docs/technical/)
- [–ì–∞–π–¥ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](../docs/security/)

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

### –ü–æ–∏—Å–∫ –∏ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–æ—Å—Ç–µ–π

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DATABASE_URL –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å PostgreSQL |
| –ù–µ–≤–∞–ª–∏–¥–Ω—ã–µ JWT —Ç–æ–∫–µ–Ω—ã | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å JWT_SECRET –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é –≤—Ä–µ–º–µ–Ω–∏ |
| –°–æ–±—ã—Ç–∏—è –Ω–µ –ø—É–±–ª–∏–∫—É—é—Ç—Å—è | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Kafka brokers –∏ event-relay |
| –í—ã—Å–æ–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ CPU | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∏ –º–µ—Ç—Ä–∏–∫–∏, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—É–ª—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π |

### –ö–æ–Ω—Ç–∞–∫—Ç—ã

- **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫**: –ö–æ–º–∞–Ω–¥–∞ Platform Ecosystem
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: [GitHub](https://github.com/your-org/platform-ecosystem)
- **Slack**: `#platform-auth`
- **Jira**: `AUTH` –ø—Ä–æ–µ–∫—Ç

---

**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: –Ø–Ω–≤–∞—Ä—å 2024  
**–õ–∏—Ü–µ–Ω–∑–∏—è**: Proprietary