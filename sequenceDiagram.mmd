graph TB
    subgraph "Клиентский слой"
        Browser[Браузер/Frontend]
    end
    
    subgraph "API Gateway (Nginx)"
        APIGW[API Gateway:443]
        HealthGW[Health: /health]
        MetricsGW[Metrics: /metrics]
    end
    
    subgraph "BFF Layer"
        BFF[BFF Gateway]
        HealthBFF[Health: ✓]
        AuthBFF[Auth Middleware]
        CacheBFF[Redis Cache]
    end
    
    subgraph "Сервисы"
        Auth[Auth Service]
        User[User Service]
        Events[Event Relay]
    end
    
    subgraph "Базы данных"
        DBAuth[(PostgreSQL: auth_db)]
        DBUser[(PostgreSQL: user_db)]
        Redis[(Redis)]
        Kafka[(Apache Kafka)]
    end
    
    subgraph "Мониторинг"
        Prometheus[Prometheus]
        Grafana[Grafana]
        Alert[AlertManager]
    end
    
    Browser --> APIGW
    APIGW --> BFF
    APIGW --> Browser
    
    BFF --> Auth
    BFF --> User
    
    Auth --> DBAuth
    Auth --> Redis
    Auth --> Kafka
    
    User --> DBUser
    User --> Redis
    User --> Kafka
    
    Events --> DBAuth
    Events --> DBUser
    Events --> Kafka
    
    Auth -->|метрики| Prometheus
    User -->|метрики| Prometheus
    BFF -->|метрики| Prometheus
    Events -->|метрики| Prometheus
    
    Prometheus --> Grafana
    Prometheus --> Alert
